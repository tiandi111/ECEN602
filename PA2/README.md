SPRING2021_ECEN602_DI_TIAN
---

### Install and Usage
First, cd to the project root path:
```
cd /project/root/path/
```
Second, make binaries:
```
mkdir bin
make
```
To start SBCP server, run:
```
./bin/server <PORT> <MaxClient=3># e.g, ./bin/server 8080 3
```
To start SBCP client, run:
```
./bin/client <USERNAME> <IPAddr> <PORT> # e.g, ./bin/client tiandi 0.0.0.0 8080 
```
To run tests:
```
./bin/test                   # unit test
sh test/intergration_test.sh # integration test
```

### Compilation Options
Make options:
```
make server # make server binary
make client # make client binary
make test   # make unit test binray
make clean  # clean the intermidiate files generated by make
```
Or you can make them all-in-once use:
```
make
```

### Design and Architecture

---
#### Design goals
This project aims to implement the Simple Broadcast Protocol which consists of four major components:
- Server
- Client
- Protocol infrastructure
- I/O System call helper functions

The Protocol infrastructure can be shared by both server-side and client-side.

--- 
#### Architecture
We find that by following the object-oriented design pattern, it is easy to develop and maintain the three major
components while reuse the Protocol infrastructure and system call helper functions. We created the following classes:

- SBCPServer

    The server that implements Simple Broadcast Protocol. The server utilize I/O multiplexing technique
    (select system call) to handle multiple clients.

- SBCPClient 

    The client that implements Simple Broadcast Protocol. The client utilize I/O multiplexing technique
    (select system call) to handle server messages and user input.

- Message
    
    Represent a message in Simple Broadcast Protocol. The message contains a header field and a payload
    field. The payload field usually consists of multiple Attribute instances(see attribute description 
    below). The Message class provide constructor, getter / setter and serialization / deserialization
    methods for caller to easily deploy the protocol.  

- Attribute:

    Represent an attribute in Simple Broadcast Protocol. The attribute contains a header field and a 
    payload field. The Attribute class provide constructor, getter / setter and serialization / 
    deserialization methods for caller to easily deploy the protocol. 

The system run as following:
```
 +----------+         +----------+ 
 |SBCPServer|         |SBCPClient|
 +----------+         +----------+
    Λ   Λ               Λ    Λ 
    | 2.|             3.|    |
    |   V               V    |
 1. |    +--------------+    | 4.
    |    |   Protocol   |    |
    |    +--------------+    |
    |                        |
    V                        V
+-----------------------------------+
| I/O system call & Helper Functions|
+-----------------------------------+
```
Explanation of the indexed arrows:
- Arrow 1

    - The SBCPServer calls socket(), bind() and listen() to listen on a port, ready for serving clients.
    
    - During running, the SBCPServer calls select() system call to monitor multiple client sockets and its
    own listening socket.
    
    - When select() returns, the SBCPServer calls accept() to build connection with new clients if any. It
    also calls read() to receive protocol messages from clients and calls write() to forward client messages
    to other clients.
    
- Arrow 2

    The SBCPServer uses the Protocol infrastructure to
    - construct new messages.
    - serialize messages to bytes that is ready for sending.
    - deserialize messages from bytes that are received from sockets. 
  
- Arrow 3

    The SBCPClient uses the Protocol infrastructure to
        - construct new messages.
        - serialize messages to bytes that is ready for sending.
        - deserialize messages from bytes that are received from sockets.

- Arrow 4

    - The SBCPClient calls socket() and connect() to build connection with the server.
        
    - During running, the SBCPClient calls select() system call to monitor the connection with the server and
    standard input.
        
    - When select() returns, the SBCPServer calls fgets() to get input from the standard input. It also calls 
    send() to send protocol messages to server and calls read() to get protocol messages from the server.

### Contribution
All by Di Tian.
    

